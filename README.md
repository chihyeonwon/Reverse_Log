이 글은 역방향 로그에 대해 분석한 보고서입니다.
역방향 로그를 분석하고 이에 대한 적절한 조치에 대한 실무 적용하면 좋을 프로세스를 정리 하였습니다.     
작성자: IGLOO Corp, Won Chi Hyun 
작성일: 2025.03.16

# 🔍 역방향 로그 분석 보고서

내부에서 외부로 나가는 통신이면 이것이 합당한, 적법한, 정당한 패킷의 흐름인가?를 판단해야할 것입니다.
웹 브라우징 (HTTP/HTTPS)

사용자가 인터넷에서 웹사이트 접속 (예: Google, 네이버, 유튜브 등)
API 호출 (외부 서비스와 연동)
이메일 송신 (SMTP, IMAP, POP3)

Outlook, Gmail 등을 이용하여 이메일 발송
메일 서버와의 통신
파일 다운로드 및 업로드 (FTP, SFTP, SCP, HTTP)

소프트웨어 업데이트 및 패치 다운로드
내부 시스템에서 외부 저장소로 파일 업로드 (예: AWS S3, Google Drive)
소프트웨어 업데이트 및 패치 (HTTPS, FTP)

운영체제 업데이트 (Windows Update, Linux 패키지 업데이트)
안티바이러스 소프트웨어 업데이트
클라우드 서비스 이용 (AWS, Google Cloud, Azure 등)

내부 시스템에서 클라우드 인프라로 접속하여 데이터 전송
SaaS(Software as a Service) 사용 (예: Google Docs, Slack, Zoom)
VPN 및 원격 접속 (SSL VPN, OpenVPN, IPSec)

원격 근무자가 VPN을 통해 외부망으로 연결
내부 시스템이 외부 VPN 서버로 트래픽 전송
VoIP 및 화상회의 (SIP, RTP, WebRTC)

Zoom, MS Teams, Google Meet 등 화상회의 이용
VoIP(인터넷 전화) 서비스 이용
DNS 조회 (UDP 53, DNS over HTTPS)

내부 시스템이 도메인 네임을 해석하기 위해 외부 DNS 서버와 통신
클라이언트 애플리케이션의 백그라운드 통신

백업 프로그램이 클라우드로 데이터 업로드
로깅 및 모니터링 서비스가 외부 분석 서버로 데이터 전송 (예: Splunk, ELK, Datadog)
온라인 게임 및 스트리밍 (TCP/UDP 1935, 3478, 8080 등)

게임 클라이언트가 서버와 통신
넷플릭스, 유튜브 스트리밍 서비스 이용

여러가지 상황의 수가 있고 이에 대한 문제가 발생하면 즉각 담당자와의 1:1 면담을 통해 조치(중단, 보고)

## 1. 개요
역방향 로그(Reverse Log)는 일반적인 네트워크 트래픽 흐름과 반대되는 방향으로 발생하는 로그를 의미합니다.  
예를 들어, 내부 네트워크에서 외부로 나가는 트래픽이 아닌, 예상치 못한 외부에서 내부로 들어오는 트래픽이 로그에 기록될 경우 이를 분석해야 합니다.

---

## 2. 분석 절차

### 📌 1) 로그 데이터 확인
우선 로그 파일에서 역방향 로그를 확인해야 합니다. 예를 들어, 아래와 같은 로그가 있다고 가정합니다.

Time: 2025-03-16 10:30:45
Source IP: 203.0.113.5
Destination IP: 192.168.1.10
Protocol: TCP
Port: 22 (SSH)
Action: Allowed

로그 가정해보겠습니다. 로그 탐지시간, 출발지ip와 목적지ip 프로토콜 포트 action 까지 간단한 로그를 생성


이 경우, 공인 IP(203.0.113.5)에서 사설 IP(192.168.1.10)로의 SSH 접속 요청이 허용되었음을 의미합니다.

---

### 📌 2) 출발지(Source IP) 분석
- **출발지 IP(203.0.113.5)가 신뢰할 수 있는 IP인가?**  
  - WHOIS 조회 (`whois 203.0.113.5`)
  - IP 조회 사이트 활용 (https://www.abuseipdb.com/)
  - 과거 로그에서 동일 IP의 접속 이력이 있는지 확인

- **출발지 IP가 악성 IP로 의심되는 경우**
  - 다른 공격 시도 기록이 있는지 확인
  - 해외 또는 의심스러운 지역에서 접근한 것인지 확인
  - 여러 번의 로그인 실패 후 성공 여부 확인

---

### 📌 3) 목적지(Destination IP) 분석
- **목적지 IP(192.168.1.10)가 어떤 시스템인가?**  
  - 내부 서버인지, 사용자 PC인지 확인
  - SSH 서비스가 활성화되어 있는지 확인 (`netstat -tulnp | grep 22`)
  - 서버의 로그(/var/log/auth.log)에서 SSH 접속 기록 분석

- **내부 시스템에서 비정상적인 응답이 있는지 확인**
  - 해당 서버에서 예상치 못한 프로세스 실행 여부 확인 (`ps aux`)
  - 비정상적인 네트워크 연결 확인 (`netstat -an | grep ESTABLISHED`)

---

### 📌 4) 트래픽 패턴 분석
- **비정상적인 다량의 접속 시도 여부**
  - 같은 출발지 IP에서 여러 번 접속 시도했는지 확인
  - 특정 시간대에 집중적으로 접속이 발생했는지 분석

- **포트 스캔 여부**
  - `nmap` 로그 확인 (`nmap -sS -p 22 192.168.1.10`)
  - IDS/IPS 시스템에서 경고가 발생했는지 확인

---

### 📌 5) 대응 방안
- **의심스러운 IP 차단**
  - `iptables` 또는 `firewalld`를 사용하여 차단  
    ```sh
    sudo iptables -A INPUT -s 203.0.113.5 -j DROP
    ```
  - `fail2ban` 설정하여 SSH 공격 방어  

- **내부 시스템 보안 강화**
  - SSH 포트 변경 (`/etc/ssh/sshd_config`에서 `Port 2222` 설정)
  - 비밀번호 로그인 차단, 키 기반 인증 적용
  - 시스템 업데이트 및 패치 적용 (`sudo apt update && sudo apt upgrade`)

- **추가 조사**
  - 침해사고 대응팀(CERT) 또는 보안 전문가에게 보고
  - 침해 지표(IOC) 공유 및 유사한 패턴 분석

---

## 3. 결론
역방향 로그가 발생하면 반드시 출발지 IP의 신뢰도를 확인하고, 내부 시스템의 응답 패턴을 분석해야 합니다.  
특히 외부에서 내부로의 예상치 못한 접속이 발생하면, 침해 가능성을 고려하여 즉각적인 대응이 필요합니다.

---

## 📌 참고 자료
- [WHOIS 조회](https://whois.domaintools.com/)
- [AbuseIPDB](https://www.abuseipdb.com/)
- [Fail2ban 설정 가이드](https://www.fail2ban.org/)
